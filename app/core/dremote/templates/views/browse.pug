extends ../layouts/default

mixin sketch(sketch)
	.sketch(data-ks-editable=editable(user, { list: 'Sketch', id: sketch.id })).media
		.media-heading
			a(href='/browse/sketch/' + sketch.slug + '?display=on')
				if sketch.image.exists
					img(src=sketch._.image.fit(720,720)).img-responsive
				else
					img(src="http://placehold.it/720x720").img-responsive
		.media-middle
			a(href='/api/' + sketch.id + '/play').btn.btn-default Display
			if sketch.ipfsHash
				a(href='https://gateway.ipfs.io/ipfs/' + sketch.ipfsHash ).btn.btn-default Preview IPFS
			else
				a(href='/api/' + sketch.id + '/sync' ).btn.btn-default Sync to IPFS
				a(href='/view-static/' + sketch.localDir ).btn.btn-default Preview Local
			//a(href='https://gateway.ipfs.io/ipns/' + sketch.ipnsHash ).btn.btn-default Preview IPNS
			//- h2.media-heading
			//- 	a(href='/browse/sketch/' + sketch.slug + '?display=on')= sketch.title
			//- p.lead.text-muted Posted 
			//- if sketch.publishedDate
			//- 	| on #{sketch._.publishedDate.format('MMMM Do, YYYY')} 
			//- if sketch.channels && sketch.channels.length
			//- 	| in 
			//- 	each channel, i in sketch.channels
			//- 		a(href='/browse/' + channel.key)= channel.name
			//- 		if i < sketch.channels.length - 1
			//- 			| , 
			//- 		else
			//- 			|  
			//- if sketch.author
			//- 	| by #{sketch.author.name.first}
		//p!= sketch.content.brief
		//if sketch.content.extended
		//	p.read-more: a(href='/browse/sketch/' + sketch.slug) Read more...

block intro
	.container
		h1= data.channel ? data.channel.name : 'Select a Sketch'

block content
	.container: .row 
		.col-sm-8.col-md-9 
			if filters.channel && !data.channel 
				h3.text-muted Invalid channel. 
			else
				if data.sketches.results.length
					//- if data.sketches.totalPages > 1
					//- 	h4.text-weight-normal Showing 
					//- 		strong #{data.sketches.first}
					//- 		|  to 
					//- 		strong #{data.sketches.last}
					//- 		|  of 
					//- 		strong #{data.sketches.total}
					//- 		|  sketches.
					//- else
					//- 	h4.text-weight-normal Showing #{utils.plural(data.sketches.results.length, '* sketch')}.
					.browse
						each sketch in data.sketches.results
							+sketch(sketch)
				
					if data.sketches.totalPages > 1
						ul.pagination
							if data.sketches.previous
								li: a(href='?page=' + data.sketches.previous): span.glyphicon.glyphicon-chevron-left
							else
								li.disabled: a(href='?page=' + 1): span.glyphicon.glyphicon-chevron-left
							each p, i in data.sketches.pages
								li(class=data.sketches.currentPage == p ? 'active' : null)
									a(href='?page=' + (p == '...' ? (i ? data.sketches.totalPages : 1) : p ))= p
							if data.sketches.next
								li: a(href='?page=' + data.sketches.next): span.glyphicon.glyphicon-chevron-right
							else
								li.disabled: a(href='?page=' + data.sketches.totalPages): span.entypo.glyphicon.glyphicon-chevron-right
				else
					if data.channel
						h3.text-muted There are no sketches in the channel #{data.channel.name}.
					else
						h3.text-muted There are no sketches yet.
		
	if data.channels.length
		.col-sm-4.col-md-3
			h2 Channels
			.list-group(style='margin-top: 70px;')
				a(href='/browse', class=!data.channel ? 'active' : false).list-group-item All Channels
				each channel in data.channels
					a(href='/browse/' + channel.key, class=data.channel && data.channel.id == channel.id ? 'active' : false).list-group-item= channel.name
block js
	script.
		jQuery(function($) {
			function playSketch(e) {

				e.preventDefault();

				var url = $(this).attr('href');

				$.get(url, function() {
					// success
				});
			}
			$(".btn-default").click( playSketch );
		});